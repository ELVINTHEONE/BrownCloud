{% extends "layout.html" %}

{% block body %}
<div class="col-md-12">
    <div class="user_favorites">
        <h3>Find a friend</h3>
        <input type="text" id="friend_search" placeholder="username"/>
        <ul id="fetched_friends"></ul>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script type="text/javascript" src="{{ url_for('static', filename='find_user.js') }}"></script>
<script>
    var page = new FindUserPage('{{ base_uri }}');
    function onSuccess(page, dataFromServer, jqueryList) {
        // empty the list
        jqueryList.empty();
        // add the fetched data
        for (var ix = 0; ix < dataFromServer.data.length; ix++) {
            var item = dataFromServer.data[ix].obj;
            var divID = ix + "_" + item.id;
            jqueryList.append("<li class='col-md-12' onclick='page.selectUser(\"" + divID + "\", \"" + item.id + "\"); return true;'>" + page.createUserListItem(item, divID) + "</li>");
        }
    }
    $(document).ready(function() {
        $("#friend_search").onDelayedKeyup({
            handler: function () {
                fetchAndAddToList(
                    page.base_uri + "friends",
                    "friend",
                    function(dataFromServer) {
                        onSuccess(page, dataFromServer, $("ul#fetched_friends"));
                    }
                )
            }
        });
    });
</script>{% endblock %}